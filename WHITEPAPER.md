# EpiProfile-Plants Dashboard: Technical White Paper

**Version 3.8** | February 2026

**Authors**: Pelayo G. de Lena Ruiz, Laboratory of Epigenetics and Chromatin Biology

---

## Abstract

EpiProfile-Plants Dashboard is an interactive, publication-quality visualization platform for histone post-translational modification (PTM) quantification data generated by EpiProfile-Plants, a MATLAB-based tool for plant mass spectrometry (MS) proteomics. The dashboard addresses a critical gap in the histone PTM analysis pipeline: the lack of integrated, interactive downstream visualization and statistical analysis tools that correctly handle the three-level hierarchical structure of EpiProfile output (derivatized peptides, peptidoforms, and individual PTMs). Built on Dash 4.0 and Plotly 6.0, the platform provides 12 interconnected analysis modules including PCA, non-parametric statistics with FDR correction, biclustering, co-occurrence analysis, quantile-normalized MS1 area quantification, and R-ready data export, all accessible through a web browser with no programming required.

---

## 1. Introduction

### 1.1 Background

Histone PTMs are key epigenetic regulators that modulate chromatin structure and gene expression. Mass spectrometry-based proteomics has become the gold standard for global, unbiased quantification of histone PTMs. EpiProfile and its plant-optimized variant, EpiProfile-Plants, process raw MS data into quantification matrices containing relative abundances (ratios) of modified peptidoforms.

However, EpiProfile outputs static PDF chromatograms and tab-separated matrices that require significant bioinformatics expertise to analyze further. Researchers must manually import data into R, Python, or GraphPad for statistical testing, PCA, and visualization. This creates a bottleneck, particularly for biologists without computational training.

### 1.2 The Three-Level Data Hierarchy Problem

A fundamental challenge in analyzing EpiProfile output is the hierarchical nature of the data:

1. **hDP (Derivatized Peptide)**: Peptide regions defined by propionylation sites (e.g., `TKQTAR(H3_3_8)`). These represent the physical peptide fragments analyzed by MS.

2. **hPF (Peptidoform)**: Combinatorial modification states on a given peptide. For example, H3_9_17 may carry K9me2 alone, K14ac alone, or K9me2K14ac together. Each combination is a distinct peptidoform.

3. **hPTM (Individual PTM)**: Single modification marks aggregated across all peptidoforms (e.g., total H3K4me1 summed from all peptides carrying this mark).

Most existing tools treat these levels interchangeably, leading to incorrect statistical conclusions. Our dashboard enforces proper level separation throughout all analyses.

### 1.3 The Compositional Data Problem

EpiProfile ratios are **compositional data**: within each peptide region, all peptidoform ratios sum to 1.0. This creates mathematical constraints that violate assumptions of standard statistical methods:

- An increase in one PTM ratio *forces* decreases in others (spurious negative correlations)
- PCA on compositional data produces geometric artifacts
- Standard fold-change calculations can be misleading

Our dashboard addresses this by offering **MS1 area-based analysis** as an alternative. Raw areas are log2-transformed and quantile-normalized, providing an absolute quantification metric free from compositional constraints.

---

## 2. Architecture

### 2.1 Technology Stack

| Component | Technology | Version |
|-----------|-----------|---------|
| Backend/Frontend | Dash (Plotly) | 4.0+ |
| Visualization | Plotly.js | 6.0+ |
| Data Processing | pandas, NumPy | 2.0+, 1.24+ |
| Statistics | SciPy, statsmodels | 1.10+, 0.14+ |
| Machine Learning | scikit-learn | 1.3+ |
| Database | SQLite3 | Built-in |
| Language | Python | 3.10+ |

### 2.2 Design Principles

- **Single-file architecture**: The entire application (~3,700 lines) is contained in one Python file for maximum portability. No build tools, no configuration files, no database servers.
- **Stateless computation**: All analysis is computed on-the-fly from in-memory DataFrames. No intermediate files or caching layers.
- **Zero configuration**: Default experiment paths are built-in; simply run `python epiprofile_dashboard.py`.
- **Publication quality**: Every plot uses consistent styling, proper axis labels, and exportable vector graphics (SVG via Plotly).

### 2.3 Data Flow

```
EpiProfile-Plants Output
        |
        v
    File Parser (TSV)
    - histone_ratios.xls --> Ratios | Areas | RT (3 blocks)
    - histone_ratios_single_PTMs.xls --> hPTM ratios
    - phenodata.tsv --> Sample metadata
        |
        v
    Normalization Pipeline
    - Areas: zeros -> NaN -> log2 -> quantile normalization
    - Ratios: used as-is (compositional, sum to 1)
        |
        v
    EXP_DATA Dictionary (in-memory)
    - hptm, hpf, areas, areas_log2, areas_norm, rt, metadata
        |
        v
    12 Analysis Tabs (Dash callbacks)
        |
        v
    Interactive Plots + Statistical Tables + Export
```

---

## 3. Analysis Modules

### 3.1 Peptidoforms Tab (hPF)

Displays the full peptidoform ratio matrix with six interactive filters:
- **Histone type** (H3, H4, H2A, H2B)
- **Peptide region** (H3_3_8, H3_9_17, etc.)
- **Experimental group**
- **Modification type** (methylation, acetylation, etc.)
- **Minimum ratio threshold**
- **Top N by variance**

Visualizations include clustered heatmaps with hierarchical ordering, violin plots for group distributions, and editable DataTables with CSV export.

### 3.2 Single PTMs Tab (hPTM)

Aggregated individual modification marks (45 total for Arabidopsis histones). Features Z-score normalization heatmaps, grouped bar charts, and violin/box plots. Provides a simplified view suitable for biological interpretation.

### 3.3 QC Dashboard

Quality control metrics including:
- **Missingness heatmap**: Visualizes non-detected peptidoforms across samples
- **Peptide completeness**: Fraction of detected features per sample
- **Area distributions**: Box plots of raw MS1 intensities per sample
- **Before/after normalization**: Side-by-side comparison of log2 areas before and after quantile normalization
- **Summary statistics cards**: Quick overview of data quality metrics

### 3.4 PCA & Clustering

**Principal Component Analysis**:
- 2D scatter plot with 95% confidence ellipses per group
- Scree plot showing variance explained by each component
- Biplot with top 15 loading arrows (most influential features)
- 3D PCA for spatial exploration
- **Data Source selector**: Switch between ratios, log2 areas, and quantile-normalized areas

**Clustering**:
- Hierarchical dendrogram (Ward linkage, Euclidean distance)
- Spearman correlation matrix heatmap
- **Spectral biclustering** (Kluger et al., 2003): Simultaneously clusters features and samples, revealing coherent submatrix patterns
- **K-Means clustering**: Feature-level clustering with cluster mean heatmap and group color annotations

### 3.5 Statistics

Non-parametric statistical testing appropriate for the typically small sample sizes in proteomics experiments:

- **Kruskal-Wallis H-test**: Non-parametric one-way ANOVA for multi-group comparisons
- **Benjamini-Hochberg FDR**: Multiple testing correction controlling the false discovery rate
- **Enrichment classification**: Automatic histone type and PTM type annotation
- **Direction assignment**: Up/Down/NS based on log2 fold-change and FDR threshold
- **Volcano plot**: -log10(FDR) vs. log2(FC) with significance thresholds
- **Significant features bar chart**: Grouped by histone type and PTM category
- **Data Source selector**: Run statistics on ratios or normalized areas
- **Design filter**: For experiments with sub-designs (e.g., PXD046034)

**Log-scale awareness**: When using area-based data (already log2-transformed), fold-change is computed as the difference of means rather than log2 of the ratio of means, avoiding double-log transformation artifacts.

### 3.6 UpSet / Co-occurrence

**UpSet Plot**: Pure Plotly implementation of UpSet plots (Lex et al., 2014) for visualizing PTM detection intersections across experimental groups. Shows which PTMs are shared vs. group-specific.

**Co-occurrence / Mutual Exclusivity Analysis**:
- Binary detection matrix (PTM present if ratio > 0.005)
- **Jaccard similarity index**: Proportion of samples where two PTMs co-occur relative to samples with either
- **Log2 odds ratio**: Quantifies enrichment (positive = co-occurring) or depletion (negative = mutually exclusive) of PTM pairs
- Hierarchical clustering of the odds ratio matrix (RdBu_r colorscale)
- Top co-occurring pairs (log2 OR > 1) and mutually exclusive pairs (log2 OR < -1)

### 3.7 Region Map

Heatmap showing mean modification ratios aggregated at the derivatized peptide (hDP) region level. Provides a bird's-eye view of the histone modification landscape across all regions and groups.

### 3.8 Comparisons

Pairwise group comparisons with:
- **Mann-Whitney U test** with BH-FDR correction
- Volcano plots per comparison
- Fold-change bar charts (top N significant)
- MA plots (mean abundance vs. fold-change)
- Data level selector: hPTM ratios, hPF ratios, or hPF areas (log2+QN)
- Group pair selector and significance threshold control

### 3.9 Phenodata

Complete sample metadata viewer including:
- Sample names, groups, file paths
- Experimental design assignments
- Editable DataTable for annotation

### 3.10 Sample Browser

Per-sample deep dive:
- PDF chromatogram viewer (embedded XIC plots from EpiProfile output)
- Individual sample PTM profile bar charts
- Sample-level statistics

### 3.11 Export to R

Generates analysis-ready R bundles:
- **User-defined filters**: Data source, experimental groups, feature subsets, design filter
- **R script generation**: Complete `.R` analysis script with heatmap (pheatmap), PCA, boxplots, volcano plot
- **Export formats**: CSV, TSV, or ZIP bundle containing:
  - Filtered data matrix
  - Sample metadata
  - R analysis script
  - Normalization parameters
- **Preview**: View first 20 rows before downloading

### 3.12 Analysis Log

SQLite-backed audit trail of all analyses performed:
- Experiment name, analysis type, parameters
- Number of features tested, number significant
- Timestamps and duration
- Upload history with file validation status

---

## 4. Normalization Pipeline

### 4.1 The Problem with Raw Areas

MS1 peak areas (raw intensities) span several orders of magnitude and exhibit systematic run-to-run biases due to variations in sample loading, ionization efficiency, and instrument performance. Direct comparison of raw areas between samples is unreliable.

### 4.2 Log2 Transformation

Raw areas are first log2-transformed after replacing zeros with NaN (non-detects):

```
area_log2 = log2(area)    where area > 0
area_log2 = NaN           where area = 0
```

Log2 transformation:
- Stabilizes variance across the intensity range
- Makes fold-changes symmetric (2x up = +1, 2x down = -1)
- Approximates normality for parametric methods

### 4.3 Quantile Normalization

Following Bolstad et al. (2003), quantile normalization forces all sample distributions to be identical:

1. Rank values within each sample (column)
2. Compute the mean value at each rank across all samples
3. Replace each value with the mean of its rank

This is performed in a NaN-aware manner: non-detected features are preserved as NaN rather than imputed, maintaining honest representation of missing data.

### 4.4 Validation

The QC Dashboard provides before/after box plots showing the effect of quantile normalization, allowing researchers to verify that systematic biases have been corrected without introducing artifacts.

---

## 5. Statistical Framework

### 5.1 Non-parametric Testing

We use non-parametric tests (Kruskal-Wallis, Mann-Whitney U) rather than parametric alternatives (ANOVA, t-test) because:

1. **Small sample sizes**: Proteomics experiments typically have 3-8 biological replicates per group, insufficient to verify normality assumptions
2. **Non-normal distributions**: Histone PTM ratios are bounded (0-1) and often heavily skewed
3. **Robustness**: Non-parametric tests are robust to outliers common in MS data

### 5.2 Multiple Testing Correction

The Benjamini-Hochberg procedure controls the False Discovery Rate (FDR) at a user-specified threshold (default 5%). With 45-87 features tested simultaneously, multiple testing correction is essential to avoid false positives.

### 5.3 Effect Size

Fold-change is computed as:
- **For ratios**: FC = log2(mean_group_B / mean_group_A)
- **For log2 areas**: FC = mean_group_B - mean_group_A (difference of logs = log of ratio)

Direction is classified as Up (FC > 0, FDR < threshold), Down (FC < 0, FDR < threshold), or NS (not significant).

---

## 6. Supported Experiments

The dashboard ships with five pre-configured Arabidopsis thaliana experiments:

| Experiment | Samples | Groups | Description |
|-----------|---------|--------|-------------|
| PXD046788 | 58 | 5 | Arabidopsis histone PTMs under various treatments |
| PXD014739 | 114 | 7 | Large-scale Arabidopsis histone modification atlas |
| PXD046034 | 48 | 8 | FAS/NAP chromatin assembly factor mutants |
| Ontogeny 1exp | 34 | 4 | Developmental ontogeny (MS1+MS2) |
| Ontogeny RawData | 34 | 4 | Developmental ontogeny (ndebug variants) |

Additional experiments can be loaded via:
- Command-line arguments: `python epiprofile_dashboard.py /path/to/new/experiment`
- Web browser upload (Replace or New experiment mode)

---

## 7. Input File Formats

### 7.1 histone_ratios.xls

Despite the `.xls` extension, this is a tab-separated (TSV) file generated by MATLAB. It contains three data blocks separated by unnamed columns:

| Block | Content | Dimensions |
|-------|---------|------------|
| Ratios | Relative abundance (0-1, sum to 1 per region) | Features x Samples |
| Areas | Raw MS1 peak intensities | Features x Samples |
| RT | Retention times (minutes) | Features x Samples |

Column headers follow the format `NUMBER,SAMPLENAME` (e.g., `1,Col_WT_1`). The parser splits on comma and uses the sample name portion.

Row headers contain peptidoform identifiers (e.g., `H3_9_17 K9me2K14ac`). Region headers (hDP level) are identified by the `(H3_x_y)` pattern.

### 7.2 histone_ratios_single_PTMs.xls

Tab-separated file with 45 individual PTM marks (Arabidopsis). Same column format as histone_ratios.xls. Contains aggregated ratios for individual modifications summed across all peptidoforms carrying that mark.

### 7.3 phenodata_arabidopsis_project.tsv

Sample metadata file with columns:
- `Sample`: Sample identifier (matches column names in ratio files)
- `Group`: Experimental condition/genotype
- `Design` (optional): Sub-experimental design for complex experiments

---

## 8. Color Palettes

The dashboard offers 12 color palettes inspired by the ggsci R package, selectable via dropdown:

| Palette | Origin | Character |
|---------|--------|-----------|
| EpiProfile (default) | Custom | Green-focused, matches theme |
| Simpsons | ggsci | Warm, high-contrast |
| Futurama | ggsci | Vibrant, tech |
| Lancet | ggsci | Medical journal |
| NEJM | ggsci | Clinical |
| Nature | ggsci | Nature Publishing |
| AAAS | ggsci | Science magazine |
| JCO | ggsci | Oncology journal |
| D3 | D3.js | Web visualization |
| UCSCGB | UCSC | Genome browser |
| Dark2 | ColorBrewer | Print-friendly |
| IGV | ggsci | Genomics viewer |

---

## 9. Database Schema

SQLite database (`epiprofile.db`) with five tables:

```sql
experiments     -- Registered experiments with sample/feature counts
analysis_log    -- Timestamped record of all analyses performed
saved_results   -- File paths to exported results
uploads         -- Upload history with validation status
sessions        -- User session tracking
```

---

## 10. Deployment

### 10.1 Local Installation

```bash
git clone https://github.com/biopelayo/epiprofile-dashboard.git
cd epiprofile-dashboard
pip install -r requirements.txt
python epiprofile_dashboard.py /path/to/epiprofile/output
```

### 10.2 System Requirements

- **Python**: 3.10 or higher
- **Memory**: ~200 MB per loaded experiment
- **Browser**: Chrome, Firefox, or Edge (modern versions)
- **OS**: Windows, macOS, or Linux

### 10.3 Command-Line Options

```
python epiprofile_dashboard.py [directories...] [--port PORT]
```

- `directories`: One or more paths to EpiProfile output directories
- `--port`: HTTP port (default: 8050)

---

## 11. Limitations and Future Work

### Current Limitations
- Single-user (no authentication or multi-tenancy)
- In-memory data (limited by available RAM)
- No imputation of missing values (non-detects remain NaN)
- No time-series or longitudinal analysis tools

### Planned Features
- Batch normalization for cross-experiment comparisons
- Imputation methods (KNN, minimum value, Bayesian)
- Gene ontology enrichment for PTM-associated pathways
- Integration with ChromHMM and other chromatin state tools
- Docker containerization for cloud deployment
- Multi-species support beyond Arabidopsis

---

## 12. References

1. **EpiProfile**: Yuan ZF, et al. (2015). EpiProfile quantifies histone peptides with modifications by extracting retention time and intensity in high-resolution mass spectra. *Molecular & Cellular Proteomics*, 14(6), 1696-1707.

2. **EpiProfile 2.0**: Yuan ZF, et al. (2018). EpiProfile 2.0: A comprehensive clinical epigenetics microarray for analysis of histone modifications. *Journal of Proteome Research*, 17(1), 556-565.

3. **Quantile Normalization**: Bolstad BM, et al. (2003). A comparison of normalization methods for high density oligonucleotide array data based on variance and bias. *Bioinformatics*, 19(2), 185-193.

4. **Spectral Biclustering**: Kluger Y, et al. (2003). Spectral biclustering of microarray data: coclustering genes and conditions. *Genome Research*, 13(4), 703-716.

5. **UpSet Plots**: Lex A, et al. (2014). UpSet: Visualization of intersecting sets. *IEEE Transactions on Visualization and Computer Graphics*, 20(12), 1983-1992.

6. **Benjamini-Hochberg**: Benjamini Y & Hochberg Y. (1995). Controlling the false discovery rate: a practical and powerful approach to multiple testing. *Journal of the Royal Statistical Society B*, 57(1), 289-300.

---

## Citation

If you use this dashboard in your research, please cite:

```
EpiProfile-Plants Dashboard v3.8
https://github.com/biopelayo/epiprofile-dashboard
```

---

## License

MIT License. See repository for details.
